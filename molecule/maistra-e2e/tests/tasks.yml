# - name: Get Kiali CR 
#   set_fact:
#     kiali_crs: "{{ lookup('k8s', api_version='kiali.io/v1alpha1', kind='Kiali', namespace=item, resource_name=kiali_operator_cr.metadata.name) }}"
#     with_items:
#     - "{{ maistra.cr.control_planes }}"


- name: Get Kiali Operator Pod
  k8s_facts:
    api_version: v1
    kind: Pod
    namespace: "{{ operators.kiali.namespace }}"
    label_selectors:
    - app = kiali-operator
  register: kiali_operator_pod

- name: Get Kiali Pod
  k8s_facts:
    api_version: v1
    kind: Pod
    namespace: "{{ item }}"
    label_selectors:
    - app = kiali
  register: kiali_pods
  with_items:
  - "{{ maistra.cr.control_planes }}"

- name: Get Kiali Pod
  k8s_facts:
    api_version: v1
    kind: Pod
    namespace: "{{ item }}"
    label_selectors:
    - app = kiali
  register: kiali_pods
  with_items:
  - "{{ maistra.cr.control_planes }}"

- name: Get Kiali Configmap
  k8s_facts:
    api_version: v1
    kind: ConfigMap
    namespace: "{{ item }}"
    name: kiali
  register: kiali_configmaps
  with_items:
  - "{{ maistra.cr.control_planes }}"
  
# - name: Get Kiali Configmap
#   set_fact:
#     kiali_configmaps: "{{ lookup('k8s', api_version='v1', kind='ConfigMap', namespace=item , resource_name='kiali') }}"
#     with_items:
#     - "{{ maistra.cr.control_planes }}"

# - name: Format Configmap
#   set_fact:
#     kiali_configmap: "{{ kiali_configmap.data['config.yaml'] | from_yaml }}"
